<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %> - LuxRide</title>
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="stylesheet" href="/css/footer.css">
  <%
    function formatDate(date) {
      if (!date) return '';
      const d = new Date(date);
      if (isNaN(d.getTime())) return date;
      const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
      return `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()}`;
    }
    function formatLocation(loc) {
      if (!loc) return '';
      const map = {
        'office':'Office','sunny-beach':'Sunny Beach','sveti-vlas':'Sveti Vlas','nesebar':'Nesebar',
        'burgas':'Burgas','burgas-airport':'Burgas Airport','sofia':'Sofia','sofia-airport':'Sofia Airport',
        'varna':'Varna','varna-airport':'Varna Airport','plovdiv':'Plovdiv','eleni':'Eleni','ravda':'Ravda'
      };
      if (map[loc]) return map[loc];
      return loc.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase()).join(' ');
    }
  %>
  <style>
    .admin-orders { padding:2rem; max-width:1200px; margin:0 auto; }
    .page-header { display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid #ef4444; padding-bottom:1rem; margin-bottom:1.25rem; }
    .page-title { color:#ef4444; margin:0; }
    .btn-admin { padding:0.45rem 0.9rem; border:1px solid; border-radius:4px; background:transparent; cursor:pointer; font-size:0.85rem; text-decoration:none; display:inline-flex; align-items:center; justify-content:center; }
    .btn-admin:hover { opacity:.85; }
    .orders-container { background:rgba(24,24,24,.65); border:2px solid #ef4444; border-radius:10px; padding:1.5rem; }
    .orders-table { width:100%; border-collapse:collapse; color:#fff; }
    .orders-table th, .orders-table td { padding:0.85rem; border-bottom:1px solid #333; text-align:left; }
    .orders-table th { background:rgba(239,68,68,.15); color:#ef4444; font-weight:600; }
    .badge { padding:0.3rem 0.75rem; border-radius:999px; font-size:0.75rem; text-transform:uppercase; letter-spacing:.03em; font-weight:700; border:1px solid rgba(239,68,68,.4); background:rgba(239,68,68,.15); color:#ef4444; }
    @media(max-width:768px){
      .admin-orders{padding:1rem;}
      .orders-table{font-size:0.85rem;}
      .orders-table th,.orders-table td{padding:0.6rem;}
    }
  </style>
</head>
<body>
  <%- include('../partials/header') %>
  <div class="admin-orders">
    <div class="page-header">
      <h1 class="page-title"><%= title %></h1>
      <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
        <a href="/admin/orders" class="btn-admin" style="border-color:#ffd23f;color:#ffd23f;">← All Orders</a>
        <form action="/admin/orders/deleted/empty" method="POST" onsubmit="return confirm('Permanently remove all deleted orders?');">
          <input type="hidden" name="_csrf" value="<%= csrfToken || '' %>">
          <button type="submit" class="btn-admin" style="border-color:#ef4444;color:#ef4444;">Empty Bin</button>
        </form>
      </div>
    </div>
    <% if (typeof error !== 'undefined' && error) { %>
      <div style="margin-bottom:1rem;padding:0.75rem 1rem;border-radius:6px;border:1px solid #ef4444;background:rgba(239,68,68,.15);color:#fecaca;">
        <%= error %>
      </div>
    <% } %>
    <div class="orders-container">
      <% if (orders && orders.length) { %>
        <div style="overflow-x:auto;">
          <table class="orders-table">
            <thead>
              <tr>
                <th>Customer</th>
                <th>Car</th>
                <th>Rental Period</th>
                <th>Locations</th>
                <th>Total</th>
                <th>Deleted At</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% orders.forEach(order => { %>
                <tr>
                  <td>
                    <div style="font-weight:600;color:#ffd23f;"><%= order.fullName %></div>
                    <div style="font-size:0.85rem;opacity:.7;"><%= order.email %><br><%= order.phoneNumber %></div>
                  </td>
                  <td>
                    <% if (order.carId) { %>
                      <div style="font-weight:600;"><%= order.carId.name %></div>
                      <div style="font-size:0.8rem;opacity:.7;"><%= order.carId.transmission %> • <%= order.carId.seats %> seats</div>
                    <% } else { %>
                      <span style="opacity:.5;">Car removed</span>
                    <% } %>
                  </td>
                  <td>
                    <div style="font-weight:600;"><%= formatDate(order.pickupDate) %> → <%= formatDate(order.returnDate) %></div>
                    <div style="font-size:0.8rem;opacity:.7;"><%= order.pickupTime %> - <%= order.returnTime %></div>
                  </td>
                  <td>
                    <div style="color:#10b981;">Pickup: <%= formatLocation(order.pickupLocation) %></div>
                    <div style="color:#3b82f6;">Return: <%= formatLocation(order.returnLocation) %></div>
                  </td>
                  <td>
                    <div style="font-weight:700;color:#ffd23f;">€<%= order.totalPrice %></div>
                    <div style="font-size:0.8rem;opacity:.7;"><%= order.rentalDays %> days</div>
                  </td>
                  <td><%= order.deletedAt ? formatDate(order.deletedAt) : '—' %></td>
                  <td><span class="badge"><%= order.status || 'active' %></span></td>
                  <td>
                    <form action="/admin/orders/<%= order._id %>/restore" method="POST"
                      onsubmit="return confirm('Restore this order and re-block the car dates for its period?');">
                      <input type="hidden" name="_csrf" value="<%= csrfToken || '' %>">
                      <button type="submit" class="btn-admin" style="border-color:#10b981;color:#10b981;">Restore</button>
                    </form>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      <% } else { %>
        <div style="text-align:center;padding:3rem;">
          <p style="color:#fff;opacity:.7;font-size:1.1rem;">Bin is empty.</p>
          <p style="color:#ef4444;opacity:.85;">Deleted orders will appear here until you empty the bin.</p>
        </div>
      <% } %>
    </div>
  </div>
  <%- include('../partials/footer') %>
  <script src="/js/mobileNav.js"></script>
</body>
</html>

